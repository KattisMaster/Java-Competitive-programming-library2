\usepackage[latin1]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{graphicx}
\usepackage{makeidx}
\usepackage{verbatim}
\usepackage[norules, nolineno, noprocindex]{lgrind}
\usepackage{pdflscape}
\usepackage{multicol}
\usepackage{listings}
\usepackage{courier}

\advance\textwidth 20 mm			%1.8 cm
%\advance\textheight 2.2 cm
%\advance\topmargin -1.3 cm
\advance\oddsidemargin  -5 mm			%0.2 cm
\advance\evensidemargin -5 mm			%0.2 cm
%\parskip = 0.2 cm


%%%%%%%%%%%%%%%%%%%%
%
% Global definitions
%
%%%%%%%%%%%%%%%%%%%%

% Remove subsections from toc:

\def\l@subsection#1#2{}


% Define lgrind style
\def\CMfont{\rmfamily\itshape} % Comment
\def\KWfont{\ttfamily\bfseries} % Keyword
\def\VRfont{\ttfamily} % Variables
\def\BGfont{\ttfamily} % Background

% Define own filename-parsing (similar to the filename@parse
% in latex but doesn't split name and extension
\def\myfilename@parse#1{%
 \let\myfilename@area\@empty
 \let\myfilename@name\@empty
 \expandafter\myfilename@path#1/\\}
 \def\myfilename@path#1/#2\\{%
  \ifx\\#2\\%
    \def\reserved@a{\edef\myfilename@name{#1}}%
  \else
    \edef\myfilename@area{\myfilename@area#1/}%
    \def\reserved@a{\myfilename@path#2\\}%
  \fi
\reserved@a}


% xinput inputs a file and changes the current path to it
% (when using xinput)
\def\thepath{}
\def\xinput#1{\myfilename@parse{#1}
{\edef\thepath{\thepath\myfilename@area}\input \thepath \myfilename@name\par}}


%%%%%%%%%%%%%%%%%%%%%%
%
% Category definitions
%
%%%%%%%%%%%%%%%%%%%%%%

\def\categorytitle#1{\def\thecategoryname{#1}\chapter{#1}\index{#1}}
\def\categoryindex#1{\index{\thecategoryname!#1 @\MakeLowercase{#1}}\index{#1}}

\def\categorycontents{\@input{\jobname.lop}}

\def\categorywritecontents{%
  \begingroup
    \makeatletter
    \if@filesw
      \expandafter\newwrite\csname tf@lop\endcsname
      \immediate\openout \csname tf@lop\endcsname \jobname.lop\relax
    \fi
    \@nobreakfalse
  \endgroup
}

\def\l@problem{\@dottedtocline{1}{1.5em}{2.3em}}
\def\l@algorithm{\@dottedtocline{2}{3.8em}{3.2em}}
\def\l@code{\@dottedtocline{1}{1.5em}{2.3em}}

\def\categorycontentline#1#2#3#4{%
	\def\style@temp{#1}%
	\ifx \style@temp\thecategoryname
		\contentsline{#2}{#3}{#4}
	\fi
}
\def\categoryaddtocontents#1#2{\addtocontents{lop}{\protect\categorycontentline%
	{\thecategoryname}{#1}{#2}{\thepage}}}


%%%%%%%%%%%%%%%%%%%%%
%
% Problem definitions
%
%%%%%%%%%%%%%%%%%%%%%

\def\problemtitle#1{\def\theproblemname{#1}\section{#1}
	\categoryindex{#1}\categoryaddtocontents{problem}{#1}}
\def\problemindex#1{\index{\thecategoryname!\theproblemname @\MakeLowercase{\theproblemname}!#1 @\MakeLowercase{#1}}%
	\index{\theproblemname!#1 @\MakeLowercase{#1}}}

%%%%%%%%%%%%%%%%%%%%%%%
%
% Algorithm definitions
%
%%%%%%%%%%%%%%%%%%%%%%%

\newenvironment{algorithm}[1]{\def\thealgorithm{#1}\subsection{#1}\problemindex{#1}%
   \categoryaddtocontents{algorithm}{\MakeLowercase{#1}}\begin{description}}{\end{description}}


\def\keyword#1{\item[#1]}

\newenvironment{source}{\verbatim\small\vspace{-0mm}}{\endverbatim}
\def\sourceline#1{{\small \tt #1}}

\def\usage#1{\keyword{Usage}\par #1}
\def\complexity#1{\keyword{Complexity} $O(#1)$}
\def\characteristics#1{\keyword{Characteristics}\par #1}
\newenvironment{example}{\keyword{Example}\source}{\endsource}
\def\valladolid#1{\keyword{Valladolid} #1}
\def\reflisting#1{\keyword{Listing} p. \pageref{code_#1}}
% Set fontsize in lgrind to tinier in landscape-source-mode
\newenvironment{sourceslandscape}{
\advance\textwidth 4 cm%
\advance\textheight 4 cm%
\advance\topmargin -2 cm%
\advance\oddsidemargin  -2 cm%
\advance\evensidemargin -2 cm%
\begin{landscape}\begin{multicols*}{2}\def\LGfsize{\scriptsize}}%
{\end{multicols*}\end{landscape}}

\newenvironment{sources}{\def\LGfsize{\small}}{}

\def\checksum#1#2#3#4{---~{\small\tt #1}~~
	{\tiny\tt\begin{tabular}{l}\\*[-7 mm] \\#2\\#3\\#4\end{tabular}}}

% \code{displayname}{filename}[label] (filenames without cpp)
\def\code#1#2{
\refstepcounter{lstlisting}
\pagebreak[3]
\label{code_#1}
\categoryaddtocontents{code}{\tt\MakeLowercase{#1}}
\vspace{1 cm}
{\normalsize\bf Listing \thelstlisting : #1.cpp}
\xinput{#2.sum}
\hrule
\lgrindfile{\thepath #2.lg}
\addcontentsline{lol}{lstlisting}
	{\protect\numberline{\thelstlisting}#1}%
}
